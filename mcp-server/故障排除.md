# 🔧 故障排除指南

## ❌ 错误: `spawn npx ENOENT`

### 症状
```
[error] Client error for command A system error occurred (spawn npx ENOENT)
```

### 原因
在本地开发时使用了 `npx` 配置，但包还没有发布到 npm。

### 解决方案

**✅ 已修复**：配置已更新为本地开发模式

你的 Cursor 配置现在是：
```json
{
  "mcpServers": {
    "qdleader": {
      "command": "node",
      "args": ["/Users/icourt/github/qdleader/mcp-server/dist/index.js"]
    }
  }
}
```

### 下一步

1. **重启 Cursor**
   - 完全退出 Cursor（⌘+Q）
   - 重新打开

2. **验证 MCP 服务器**
   - 在 Cursor 中查看 MCP 服务器状态
   - 应该看到 `qdleader` 服务器已连接

3. **测试功能**
   ```
   帮我搜索 Vue3 相关的文档
   ```

## 📋 完整的故障排除流程

### 步骤 1: 检查文件是否存在

```bash
ls -la /Users/icourt/github/qdleader/mcp-server/dist/index.js
```

**期望输出**：
```
-rw-r--r--  1 icourt  staff  11K Nov  3 14:29 index.js
```

**如果文件不存在**：
```bash
cd /Users/icourt/github/qdleader/mcp-server
npm run build
```

### 步骤 2: 检查文件是否可执行

```bash
node /Users/icourt/github/qdleader/mcp-server/dist/index.js
```

**期望输出**：
```
[MCP] QDLeader MCP Server running on stdio
```

按 Ctrl+C 退出。

**如果看到错误**：检查依赖是否安装
```bash
cd /Users/icourt/github/qdleader/mcp-server
npm install
npm run build
```

### 步骤 3: 检查 Cursor 配置

打开 `~/.cursor/mcp.json`，确认内容为：

```json
{
  "mcpServers": {
    "qdleader": {
      "command": "node",
      "args": ["/Users/icourt/github/qdleader/mcp-server/dist/index.js"]
    }
  }
}
```

### 步骤 4: 查看 Cursor 日志

1. 打开 Cursor
2. 按 ⌘+⇧+P (Command + Shift + P)
3. 输入 "Developer: Toggle Developer Tools"
4. 查看 Console 标签中的错误

### 步骤 5: 重启 Cursor

1. 完全退出 Cursor (⌘+Q)
2. 重新打开 Cursor
3. 等待几秒让 MCP 服务器初始化

### 步骤 6: 测试 MCP 功能

在 Cursor 中输入：

```
列出所有可用的技术分类
```

或

```
搜索 React hooks 相关文档
```

## 🐛 常见错误及解决方案

### 错误 1: "No server info found"

**原因**：MCP 服务器没有正确启动

**解决**：
1. 检查配置文件路径是否正确
2. 确保文件有执行权限
3. 重启 Cursor

### 错误 2: "Cannot find module"

**原因**：依赖没有安装或构建失败

**解决**：
```bash
cd /Users/icourt/github/qdleader/mcp-server
rm -rf node_modules package-lock.json
npm install
npm run build
```

### 错误 3: "ENOENT: no such file or directory"

**原因**：配置中的路径不正确

**解决**：
1. 确认路径使用绝对路径
2. 确认 dist/index.js 文件存在
3. 更新配置文件

### 错误 4: 服务器启动但没有响应

**原因**：可能索引文档失败

**解决**：
1. 检查仓库根目录是否正确
2. 确认有 markdown 文件可以索引
3. 查看 Cursor 开发者工具的 Console 日志

## 🔍 调试模式

### 手动运行 MCP 服务器查看详细输出

```bash
cd /Users/icourt/github/qdleader/mcp-server
node dist/index.js
```

应该看到：
```
[MCP] QDLeader MCP Server running on stdio
[MCP] Building document index...
[MCP] Indexed XXX documents
```

### 测试文档索引

创建测试文件 `test-index.js`：

```javascript
import { glob } from 'glob';
import path from 'path';

const REPO_ROOT = path.resolve(process.cwd(), '..');

async function testIndex() {
  console.log('Repository root:', REPO_ROOT);
  
  const files = await glob('**/*.md', {
    cwd: REPO_ROOT,
    ignore: ['node_modules/**', 'mcp-server/**', '.git/**'],
  });
  
  console.log(`Found ${files.length} markdown files`);
  console.log('First 10 files:');
  files.slice(0, 10).forEach(f => console.log(`  - ${f}`));
}

testIndex();
```

运行：
```bash
node test-index.js
```

## 📞 获取帮助

### 检查系统环境

```bash
# Node.js 版本
node --version  # 应该 >= 18

# npm 版本
npm --version

# 当前目录
pwd

# 检查文件
ls -la dist/
```

### 收集诊断信息

运行测试脚本：
```bash
cd /Users/icourt/github/qdleader/mcp-server
./test-package.sh > diagnosis.txt 2>&1
cat diagnosis.txt
```

### 联系支持

如果问题仍然存在，提供以下信息：

1. **错误消息**（从 Cursor 开发者工具）
2. **系统信息**
   - macOS 版本
   - Node.js 版本
   - Cursor 版本
3. **配置文件**（`~/.cursor/mcp.json`）
4. **诊断输出**（`./test-package.sh` 的输出）

## ✅ 成功标志

当一切正常时，你应该看到：

1. **Cursor 状态栏**
   - MCP 服务器图标显示已连接

2. **AI 对话**
   - 可以使用 MCP 工具
   - 能搜索和读取文档

3. **测试命令**
   ```
   列出所有可用的技术分类
   ```
   
   **期望响应**：
   ```
   Total Categories: XX
   
   - vue: XX document(s)
   - react: XX document(s)
   - ...
   ```

## 🎯 快速修复检查清单

- [ ] ✅ Cursor 配置已更新为本地路径
- [ ] ✅ dist/index.js 文件存在
- [ ] ✅ 依赖已安装（node_modules 存在）
- [ ] ✅ 可以手动运行 `node dist/index.js`
- [ ] ⏳ 重启 Cursor
- [ ] ⏳ 测试 MCP 功能

---

**当前状态**: ✅ 配置已修复，请重启 Cursor

**下一步**: 重启 Cursor 并测试搜索功能！

