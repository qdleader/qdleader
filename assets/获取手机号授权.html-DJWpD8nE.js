import{_ as s,c as a,a as p,o as e}from"./app-D8HvJIFE.js";const t={};function o(l,n){return e(),a("div",null,[...n[0]||(n[0]=[p(`<h1 id="获取手机号授权" tabindex="-1"><a class="header-anchor" href="#获取手机号授权"><span>获取手机号授权</span></a></h1><p>微信小程序 获取手机号授权</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token operator">&lt;</span>button open<span class="token operator">-</span>type<span class="token operator">=</span><span class="token string">&quot;getPhoneNumber&quot;</span> bindgetphonenumber<span class="token operator">=</span><span class="token string">&quot;getPhoneNumber&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btnPhone {{mobile !=&#39;&#39;?&#39;btnPhoneActive&#39;:&#39;&#39;}}&quot;</span><span class="token operator">&gt;</span>获取手机号<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 获取手机号开始</span></span>
<span class="line">　　<span class="token function-variable function">getPhoneNumber</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">var</span> ivObj <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>iv</span>
<span class="line">        <span class="token keyword">var</span> telObj <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>encryptedData</span>
<span class="line">        <span class="token keyword">var</span> codeObj <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//------执行Login---------</span></span>
<span class="line">        wx<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;code转换&#39;</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">　　　　　　<span class="token comment">//用code传给服务器调换session_key</span></span>
<span class="line">        <span class="token comment">// userGetMobile</span></span>
<span class="line">      requestApi<span class="token punctuation">.</span><span class="token function">userGetMobile</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">vcode</span><span class="token operator">:</span> res<span class="token punctuation">.</span>code<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">encryptedData</span><span class="token operator">:</span> telObj<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">iv</span><span class="token operator">:</span> ivObj</span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;获取手机号成功&quot;</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;res.data.data.phoneNumber&quot;</span><span class="token punctuation">,</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>phoneNumber<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">            that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">mobile</span><span class="token operator">:</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>phoneNumber<span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">openid</span><span class="token operator">:</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>openid<span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">unionid</span><span class="token operator">:</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>unionid<span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token comment">// console.log(&quot;手机号=&quot;, res.data.data.phoneNumber)</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// post请求</span></span>
<span class="line">            that<span class="token punctuation">.</span><span class="token function">postInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">              <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;获取手机号成功!&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 标题</span></span>
<span class="line">              <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">&#39;success&#39;</span><span class="token punctuation">,</span>  <span class="token comment">// 图标类型，默认success</span></span>
<span class="line">              <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">1500</span>  <span class="token comment">// 提示窗停留时间，默认1500ms</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//-----------------是否授权，授权通过进入主页面，授权拒绝则停留在登陆界面</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>errMsg <span class="token operator">==</span> <span class="token string">&#39;getPhoneNumber:user deny&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//用户点击拒绝</span></span>
<span class="line">                <span class="token comment">// wx.navigateTo({</span></span>
<span class="line">                <span class="token comment">//     url: &#39;../index/index&#39;,</span></span>
<span class="line">                <span class="token comment">// })</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">//允许授权执行跳转</span></span>
<span class="line">                <span class="token comment">// wx.navigateTo({</span></span>
<span class="line">                <span class="token comment">//     url: &#39;../test/test&#39;,</span></span>
<span class="line">                <span class="token comment">// })</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token comment">// 获取手机号 结束</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4)])])}const i=s(t,[["render",o]]),u=JSON.parse('{"path":"/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/%E8%8E%B7%E5%8F%96%E6%89%8B%E6%9C%BA%E5%8F%B7%E6%8E%88%E6%9D%83.html","title":"获取手机号授权","lang":"zh-CN","frontmatter":{},"git":{"updatedTime":1761877037000,"contributors":[{"name":"qdleader","username":"qdleader","email":"yk4545945@163.com","commits":1,"url":"https://github.com/qdleader"}],"changelog":[{"hash":"bd7640b59685e94edda53b9f6d34fbec27933dd4","time":1761877037000,"email":"yk4545945@163.com","author":"qdleader","message":"docs: 更新仓库链接和添加交流社区信息"}]},"filePathRelative":"微信小程序/获取手机号授权.md"}');export{i as comp,u as data};
