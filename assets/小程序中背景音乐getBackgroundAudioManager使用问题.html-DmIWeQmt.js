import{_ as s,c as a,a as p,o as t}from"./app-KfnfuIf0.js";const e={};function o(c,n){return t(),a("div",null,[...n[0]||(n[0]=[p(`<h1 id="小程序中背景音乐getbackgroundaudiomanager使用问题" tabindex="-1"><a class="header-anchor" href="#小程序中背景音乐getbackgroundaudiomanager使用问题"><span>小程序中背景音乐getBackgroundAudioManager使用问题</span></a></h1><h3 id="_1-当你在-onplay方法中写入计时器时候-计时器会没两秒或三秒更新一次" tabindex="-1"><a class="header-anchor" href="#_1-当你在-onplay方法中写入计时器时候-计时器会没两秒或三秒更新一次"><span>1. 当你在 onPlay方法中写入计时器时候，计时器会没两秒或三秒更新一次</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"> <span class="token keyword">var</span> manager <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getBackgroundAudioManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      manager<span class="token punctuation">.</span>title <span class="token operator">=</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>audioList<span class="token punctuation">[</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>audioIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>trackCtitle <span class="token operator">||</span> <span class="token string">&quot;音频标题&quot;</span><span class="token punctuation">;</span></span>
<span class="line">      manager<span class="token punctuation">.</span>epname <span class="token operator">=</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>playlistName <span class="token operator">||</span> <span class="token string">&quot;专辑名称&quot;</span><span class="token punctuation">;</span></span>
<span class="line">      manager<span class="token punctuation">.</span>singer <span class="token operator">=</span> audio<span class="token punctuation">.</span>author <span class="token operator">||</span> <span class="token string">&quot;歌手名&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// manager.coverImgUrl = audio.poster;</span></span>
<span class="line">      <span class="token comment">// 设置了 src 之后会自动播放</span></span>
<span class="line">      manager<span class="token punctuation">.</span>src <span class="token operator">=</span> audio<span class="token punctuation">;</span></span>
<span class="line">      manager<span class="token punctuation">.</span>currentTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      manager<span class="token punctuation">.</span><span class="token function">onPlay</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;======onPlay======&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">playStatus</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">pausedSwitch</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">currentUrl</span><span class="token operator">:</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>解决方法是把计时器提出来在别的事件中写</p><p>eg：我在播放按钮时候启动计时器</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//播放按钮</span></span>
<span class="line"><span class="token function-variable function">playOrpause</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> manager <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getBackgroundAudioManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>playStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    manager<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">playStatus</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">clearInterval</span><span class="token punctuation">(</span>timerLeft<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment">// this.setData({</span></span>
<span class="line">    <span class="token comment">//     num3:1</span></span>
<span class="line">    <span class="token comment">// })</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    manager<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">playStatus</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">countTimeDownNew</span><span class="token punctuation">(</span>manager<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line"><span class="token function-variable function">countTimeDownNew</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">manager<span class="token punctuation">,</span> cancel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">      timerLeft <span class="token operator">=</span>  <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">           <span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>num3 <span class="token operator">+</span> <span class="token number">1</span></span>
<span class="line">           <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">             <span class="token literal-property property">num3</span><span class="token operator">:</span>num</span>
<span class="line">           <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>playStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;that.formatTime(Math.ceil(manager.currentTime)&quot;</span><span class="token punctuation">,</span>that<span class="token punctuation">.</span><span class="token function">formatTime</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>manager<span class="token punctuation">.</span>currentTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">            that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">              <span class="token literal-property property">progress</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>manager<span class="token punctuation">.</span>currentTime<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">progressText</span><span class="token operator">:</span> that<span class="token punctuation">.</span><span class="token function">formatTime</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>manager<span class="token punctuation">.</span>currentTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">progressText</span><span class="token operator">:</span> that<span class="token punctuation">.</span><span class="token function">formatTime</span><span class="token punctuation">(</span>manager<span class="token punctuation">.</span>currentTime<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">duration</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>manager<span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">durationText</span><span class="token operator">:</span> that<span class="token punctuation">.</span><span class="token function">formatTime</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>manager<span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">       <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-manager-onpause在暂停时候-会在手机上循环一直调用onpause方法-调试器上没事" tabindex="-1"><a class="header-anchor" href="#_2-manager-onpause在暂停时候-会在手机上循环一直调用onpause方法-调试器上没事"><span>2.manager.onpause在暂停时候 会在手机上循环一直调用onpause方法，调试器上没事</span></a></h3><p>在苹果11上表现是图标一直会闪</p><p>修复方案是在onPause方法里面加个 pausedSwitch属性开关</p><p>播放时候再打开</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">manager<span class="token punctuation">.</span><span class="token function">onPause</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;一致获取内容222&quot;</span><span class="token punctuation">)</span></span>
<span class="line">          <span class="token keyword">if</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>pausedSwitch<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">              <span class="token literal-property property">pausedSwitch</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;一致获取内容2&quot;</span><span class="token punctuation">)</span></span>
<span class="line">              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;that.data.progress1&quot;</span><span class="token punctuation">,</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>progress<span class="token punctuation">)</span></span>
<span class="line">              manager<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>progress<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">progressText</span><span class="token operator">:</span> that<span class="token punctuation">.</span><span class="token function">formatTime</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>progress<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">progress</span><span class="token operator">:</span>Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>progress<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">playStatus</span><span class="token operator">:</span> <span class="token boolean">false</span></span>
<span class="line">              <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">              that<span class="token punctuation">.</span><span class="token function">changeData</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">              that<span class="token punctuation">.</span><span class="token function">startSetInter2</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;开始 that.data.num2&quot;</span><span class="token punctuation">,</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>num2<span class="token punctuation">)</span></span>
<span class="line">              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;开始 that.data.isReload&quot;</span><span class="token punctuation">,</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>isReload<span class="token punctuation">)</span></span>
<span class="line">              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;======onPause 基础方法1======&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,11)])])}const i=s(e,[["render",o]]),u=JSON.parse('{"path":"/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B8%AD%E8%83%8C%E6%99%AF%E9%9F%B3%E4%B9%90getBackgroundAudioManager%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98.html","title":"小程序中背景音乐getBackgroundAudioManager使用问题","lang":"zh-CN","frontmatter":{},"git":{"updatedTime":1768183010000,"contributors":[{"name":"qdleader","username":"qdleader","email":"yk4545945@163.com","commits":1,"url":"https://github.com/qdleader"}],"changelog":[{"hash":"c3ab6d103d428cdd6a361e045add7154fc9253f1","time":1768183010000,"email":"yk4545945@163.com","author":"qdleader","message":"docs(mcp): 新增Mastergo MCP配置文档，包含token获取方法"}]},"filePathRelative":"微信小程序/小程序中背景音乐getBackgroundAudioManager使用问题.md"}');export{i as comp,u as data};
