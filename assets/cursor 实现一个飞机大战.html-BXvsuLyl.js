import{_ as s,c as a,a as p,o as t}from"./app-KfnfuIf0.js";const e={};function l(c,n){return t(),a("div",null,[...n[0]||(n[0]=[p(`<h1 id="cursor-实现一个飞机大战" tabindex="-1"><a class="header-anchor" href="#cursor-实现一个飞机大战"><span>cursor 实现一个飞机大战</span></a></h1><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">用<span class="token constant">HTML5</span> Canvas做一个飞机大战的游戏。要求如下：</span>
<span class="line"><span class="token number">1</span>） 有终局<span class="token constant">BOSS</span>关卡，终局<span class="token constant">BOSS</span>有自己独有的技能，终局<span class="token constant">BOSS</span>消灭有难度，只有消灭终局<span class="token constant">BOSS</span>游戏才能通关</span>
<span class="line"><span class="token number">2</span>）击败敌机后会随机爆一些道具，道具可以增加子弹威力、效果，也可以让自己短时间内变大。道具吃到了就要马上用掉，有时间限制</span>
<span class="line"><span class="token number">3</span>）击败敌机会有经验值，经验够了会升级，升级后会有更强大的子弹技能。</span>
<span class="line"><span class="token number">4</span>） 会有一些小<span class="token constant">BOSS</span>，小<span class="token constant">BOSS</span>血厚一点，击败会爆一些更强的道具</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>飞机大战<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"></span>
<span class="line">      <span class="token selector">body</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">background-color</span><span class="token punctuation">:</span> #222<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">font-family</span><span class="token punctuation">:</span> Arial<span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token selector">#gameContainer</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token selector">#gameCanvas</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">border</span><span class="token punctuation">:</span> 2px solid #444<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 0 20px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token selector">#startScreen,</span>
<span class="line">      #gameOverScreen,</span>
<span class="line">      #levelUpScreen,</span>
<span class="line">      #victoryScreen</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.7<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token selector">#gameOverScreen,</span>
<span class="line">      #levelUpScreen,</span>
<span class="line">      #victoryScreen</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token selector">button</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">margin-top</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">padding</span><span class="token punctuation">:</span> 10px 20px<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">font-size</span><span class="token punctuation">:</span> 18px<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">background-color</span><span class="token punctuation">:</span> #4caf50<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">transition</span><span class="token punctuation">:</span> background-color 0.3s<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token selector">button:hover</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">background-color</span><span class="token punctuation">:</span> #45a049<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token selector">#hud</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">left</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">text-shadow</span><span class="token punctuation">:</span> 1px 1px 2px black<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token selector">.skill-option</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">margin</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #4caf50<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span></span>
<span class="line">        <span class="token property">transition</span><span class="token punctuation">:</span> background-color 0.3s<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token selector">.skill-option:hover</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>76<span class="token punctuation">,</span> 175<span class="token punctuation">,</span> 80<span class="token punctuation">,</span> 0.3<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gameContainer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gameCanvas<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>480<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>640<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hud<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>生命: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lives<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>分数: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>score<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>等级: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>level<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>经验: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>exp<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>expNeeded<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>100<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>关卡: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stage<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bossHealthContainer<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">          BOSS生命: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bossHealth<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>100<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>startScreen<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>飞机大战<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>使用方向键移动，空格键射击<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>击败敌人获得经验升级<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>收集道具增强能力<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>最终击败BOSS赢得胜利!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>startButton<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>开始游戏<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gameOverScreen<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>游戏结束<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>最终得分: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>finalScore<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>达到等级: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>finalLevel<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>restartButton<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>重新开始<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>levelUpScreen<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>等级提升!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>选择一项升级:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>skill-option<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fireRate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>射击速度<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>提高射击速度<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>skill-option<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bulletPower<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>子弹威力<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>增加子弹伤害<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>skill-option<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>multiShot<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>多重射击<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>同时发射多颗子弹<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>victoryScreen<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>胜利!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>你击败了最终BOSS!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>最终得分: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>victoryScore<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>达到等级: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>victoryLevel<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>victoryRestartButton<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>再来一次<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line">      <span class="token comment">// 游戏常量</span></span>
<span class="line">      <span class="token keyword">const</span> <span class="token constant">CANVAS_WIDTH</span> <span class="token operator">=</span> <span class="token number">480</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">const</span> <span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">=</span> <span class="token number">640</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">const</span> <span class="token constant">PLAYER_SPEED</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">const</span> <span class="token constant">ENEMY_SPEED</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">const</span> <span class="token constant">BULLET_SPEED</span> <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">const</span> <span class="token constant">POWERUP_DURATION</span> <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span> <span class="token comment">// 10秒</span></span>
<span class="line">      <span class="token keyword">const</span> <span class="token constant">BOSS_SKILL_INTERVAL</span> <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span> <span class="token comment">// 3秒</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 游戏变量</span></span>
<span class="line">      <span class="token keyword">let</span> canvas<span class="token punctuation">,</span> ctx<span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> gameRunning <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> animationFrameId<span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> keys <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> player <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token constant">CANVAS_WIDTH</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">-</span> <span class="token number">60</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">speed</span><span class="token operator">:</span> <span class="token constant">PLAYER_SPEED</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">lives</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">score</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">level</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">exp</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">expNeeded</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">fireRate</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token comment">// 毫秒</span></span>
<span class="line">          <span class="token literal-property property">lastShot</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">bulletPower</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">multiShot</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">isPoweredUp</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">powerUpType</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">powerUpEndTime</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">sizeMultiplier</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">invulnerable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">invulnerableEndTime</span><span class="token operator">:</span> <span class="token number">0</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">let</span> bullets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> enemies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> powerUps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> explosions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> stage <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> enemySpawnTimer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> enemySpawnInterval <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> boss <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> bossActive <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> bossSkillTimer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> bossBullets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token comment">// 需要在全局变量中添加 enemiesDefeatedThisStage</span></span>
<span class="line">      <span class="token keyword">let</span> enemiesDefeatedThisStage <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 然后在敌人被击败的地方增加计数</span></span>
<span class="line">      <span class="token comment">// 在 checkCollisions() 函数中找到敌人被击败的代码，添加：</span></span>
<span class="line">      enemiesDefeatedThisStage<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token comment">// 初始化游戏</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;gameCanvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 事件监听</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;keydown&#39;</span><span class="token punctuation">,</span> handleKeyDown<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;keyup&#39;</span><span class="token punctuation">,</span> handleKeyUp<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;startButton&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> startGame<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;restartButton&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> restartGame<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;victoryRestartButton&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> restartGame<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 等级升级选项</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&#39;.skill-option&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">option</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">              option<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  <span class="token keyword">const</span> type <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;data-type&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                  <span class="token function">applyLevelUp</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;levelUpScreen&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">;</span></span>
<span class="line">                  gameRunning <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">                  <span class="token function">gameLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 绘制开始屏幕</span></span>
<span class="line">          <span class="token function">drawStartScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 开始游戏</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">startGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;startScreen&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token function">resetGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          gameRunning <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token function">gameLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 重置游戏</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">resetGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          player <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token constant">CANVAS_WIDTH</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">-</span> <span class="token number">60</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">speed</span><span class="token operator">:</span> <span class="token constant">PLAYER_SPEED</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">lives</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">score</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">level</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">exp</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">expNeeded</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">fireRate</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">lastShot</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">bulletPower</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">multiShot</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">isPoweredUp</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">powerUpType</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">powerUpEndTime</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">sizeMultiplier</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">invulnerable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">invulnerableEndTime</span><span class="token operator">:</span> <span class="token number">0</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          bullets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">          enemies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">          powerUps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">          explosions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">          bossBullets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">          enemiesDefeatedThisStage <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">          stage <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">          enemySpawnTimer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">          enemySpawnInterval <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span></span>
<span class="line">          boss <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">          bossActive <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token function">updateHUD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;bossHealthContainer&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 重新开始游戏</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">restartGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;gameOverScreen&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">;</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;victoryScreen&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token function">resetGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          gameRunning <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token function">gameLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 游戏结束</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">gameOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          gameRunning <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span>animationFrameId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;finalScore&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> player<span class="token punctuation">.</span>score<span class="token punctuation">;</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;finalLevel&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> player<span class="token punctuation">.</span>level<span class="token punctuation">;</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;gameOverScreen&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;flex&#39;</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 游戏胜利</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">victory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          gameRunning <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span>animationFrameId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;victoryScore&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> player<span class="token punctuation">.</span>score<span class="token punctuation">;</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;victoryLevel&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> player<span class="token punctuation">.</span>level<span class="token punctuation">;</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;victoryScreen&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;flex&#39;</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 游戏主循环</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">gameLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gameRunning<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          animationFrameId <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>gameLoop<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 清空画布</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_WIDTH</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 更新游戏状态</span></span>
<span class="line">          <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 绘制游戏</span></span>
<span class="line">          <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 更新游戏状态</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token comment">// 更新玩家</span></span>
<span class="line">          <span class="token function">updatePlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 生成敌人</span></span>
<span class="line">          <span class="token function">updateEnemySpawn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 更新子弹</span></span>
<span class="line">          <span class="token function">updateBullets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 更新敌人</span></span>
<span class="line">          <span class="token function">updateEnemies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 更新BOSS</span></span>
<span class="line">          <span class="token function">updateBoss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 更新BOSS子弹</span></span>
<span class="line">          <span class="token function">updateBossBullets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 更新道具</span></span>
<span class="line">          <span class="token function">updatePowerUps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 更新爆炸效果</span></span>
<span class="line">          <span class="token function">updateExplosions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 检查碰撞</span></span>
<span class="line">          <span class="token function">checkCollisions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 检查玩家无敌状态</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>player<span class="token punctuation">.</span>invulnerable <span class="token operator">&amp;&amp;</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> player<span class="token punctuation">.</span>invulnerableEndTime<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              player<span class="token punctuation">.</span>invulnerable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 检查道具持续时间</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>player<span class="token punctuation">.</span>isPoweredUp <span class="token operator">&amp;&amp;</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> player<span class="token punctuation">.</span>powerUpEndTime<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              player<span class="token punctuation">.</span>isPoweredUp <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">              player<span class="token punctuation">.</span>powerUpType <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">              player<span class="token punctuation">.</span>sizeMultiplier <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 检查关卡进度</span></span>
<span class="line">          <span class="token function">checkStageProgress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 更新玩家</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">updatePlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token comment">// 移动玩家</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>keys<span class="token punctuation">[</span><span class="token string">&#39;ArrowLeft&#39;</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> player<span class="token punctuation">.</span>x <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              player<span class="token punctuation">.</span>x <span class="token operator">-=</span> player<span class="token punctuation">.</span>speed<span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>keys<span class="token punctuation">[</span><span class="token string">&#39;ArrowRight&#39;</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> player<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> <span class="token constant">CANVAS_WIDTH</span> <span class="token operator">-</span> player<span class="token punctuation">.</span>width <span class="token operator">*</span> player<span class="token punctuation">.</span>sizeMultiplier<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              player<span class="token punctuation">.</span>x <span class="token operator">+=</span> player<span class="token punctuation">.</span>speed<span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>keys<span class="token punctuation">[</span><span class="token string">&#39;ArrowUp&#39;</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> player<span class="token punctuation">.</span>y <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              player<span class="token punctuation">.</span>y <span class="token operator">-=</span> player<span class="token punctuation">.</span>speed<span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>keys<span class="token punctuation">[</span><span class="token string">&#39;ArrowDown&#39;</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> player<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> <span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">-</span> player<span class="token punctuation">.</span>height <span class="token operator">*</span> player<span class="token punctuation">.</span>sizeMultiplier<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              player<span class="token punctuation">.</span>y <span class="token operator">+=</span> player<span class="token punctuation">.</span>speed<span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 玩家射击</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>keys<span class="token punctuation">[</span><span class="token string">&#39; &#39;</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> player<span class="token punctuation">.</span>lastShot <span class="token operator">&gt;</span> player<span class="token punctuation">.</span>fireRate<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token function">shoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              player<span class="token punctuation">.</span>lastShot <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 玩家射击</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">shoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">const</span> bulletWidth <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">const</span> bulletHeight <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>player<span class="token punctuation">.</span>multiShot <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token comment">// 单发子弹</span></span>
<span class="line">              bullets<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                  <span class="token literal-property property">x</span><span class="token operator">:</span> player<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>player<span class="token punctuation">.</span>width <span class="token operator">*</span> player<span class="token punctuation">.</span>sizeMultiplier<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> bulletWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">y</span><span class="token operator">:</span> player<span class="token punctuation">.</span>y<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">width</span><span class="token operator">:</span> bulletWidth<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">height</span><span class="token operator">:</span> bulletHeight<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">speed</span><span class="token operator">:</span> <span class="token constant">BULLET_SPEED</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">power</span><span class="token operator">:</span> player<span class="token punctuation">.</span>bulletPower</span>
<span class="line">              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>player<span class="token punctuation">.</span>multiShot <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token comment">// 双发子弹</span></span>
<span class="line">              bullets<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                  <span class="token literal-property property">x</span><span class="token operator">:</span> player<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>player<span class="token punctuation">.</span>width <span class="token operator">*</span> player<span class="token punctuation">.</span>sizeMultiplier<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">4</span> <span class="token operator">-</span> bulletWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">y</span><span class="token operator">:</span> player<span class="token punctuation">.</span>y<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">width</span><span class="token operator">:</span> bulletWidth<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">height</span><span class="token operator">:</span> bulletHeight<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">speed</span><span class="token operator">:</span> <span class="token constant">BULLET_SPEED</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">power</span><span class="token operator">:</span> player<span class="token punctuation">.</span>bulletPower</span>
<span class="line">              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">              bullets<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                  <span class="token literal-property property">x</span><span class="token operator">:</span> player<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>player<span class="token punctuation">.</span>width <span class="token operator">*</span> player<span class="token punctuation">.</span>sizeMultiplier<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">/</span> <span class="token number">4</span> <span class="token operator">-</span> bulletWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">y</span><span class="token operator">:</span> player<span class="token punctuation">.</span>y<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">width</span><span class="token operator">:</span> bulletWidth<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">height</span><span class="token operator">:</span> bulletHeight<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">speed</span><span class="token operator">:</span> <span class="token constant">BULLET_SPEED</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">power</span><span class="token operator">:</span> player<span class="token punctuation">.</span>bulletPower</span>
<span class="line">              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>player<span class="token punctuation">.</span>multiShot <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token comment">// 三发子弹</span></span>
<span class="line">              bullets<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                  <span class="token literal-property property">x</span><span class="token operator">:</span> player<span class="token punctuation">.</span>x <span class="token operator">-</span> bulletWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">y</span><span class="token operator">:</span> player<span class="token punctuation">.</span>y<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">width</span><span class="token operator">:</span> bulletWidth<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">height</span><span class="token operator">:</span> bulletHeight<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">speed</span><span class="token operator">:</span> <span class="token constant">BULLET_SPEED</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">power</span><span class="token operator">:</span> player<span class="token punctuation">.</span>bulletPower</span>
<span class="line">              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">              bullets<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                  <span class="token literal-property property">x</span><span class="token operator">:</span> player<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>player<span class="token punctuation">.</span>width <span class="token operator">*</span> player<span class="token punctuation">.</span>sizeMultiplier<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> bulletWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">y</span><span class="token operator">:</span> player<span class="token punctuation">.</span>y<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">width</span><span class="token operator">:</span> bulletWidth<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">height</span><span class="token operator">:</span> bulletHeight<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">speed</span><span class="token operator">:</span> <span class="token constant">BULLET_SPEED</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">power</span><span class="token operator">:</span> player<span class="token punctuation">.</span>bulletPower</span>
<span class="line">              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">              bullets<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                  <span class="token literal-property property">x</span><span class="token operator">:</span> player<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>player<span class="token punctuation">.</span>width <span class="token operator">*</span> player<span class="token punctuation">.</span>sizeMultiplier<span class="token punctuation">)</span> <span class="token operator">-</span> bulletWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">y</span><span class="token operator">:</span> player<span class="token punctuation">.</span>y<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">width</span><span class="token operator">:</span> bulletWidth<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">height</span><span class="token operator">:</span> bulletHeight<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">speed</span><span class="token operator">:</span> <span class="token constant">BULLET_SPEED</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">power</span><span class="token operator">:</span> player<span class="token punctuation">.</span>bulletPower</span>
<span class="line">              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 更新敌人生成</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">updateEnemySpawn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bossActive<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              enemySpawnTimer <span class="token operator">+=</span> <span class="token number">16</span><span class="token punctuation">;</span> <span class="token comment">// 假设60fps，每帧约16ms</span></span>
<span class="line"></span>
<span class="line">              <span class="token keyword">if</span> <span class="token punctuation">(</span>enemySpawnTimer <span class="token operator">&gt;=</span> enemySpawnInterval<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  <span class="token function">spawnEnemy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                  enemySpawnTimer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                  <span class="token comment">// 随着关卡提高，敌人生成速度加快</span></span>
<span class="line">                  enemySpawnInterval <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">1000</span> <span class="token operator">-</span> stage <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 生成敌人</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">spawnEnemy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">const</span> size <span class="token operator">=</span> <span class="token number">30</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">const</span> isMiniBoss <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.1</span><span class="token punctuation">;</span> <span class="token comment">// 10%几率生成小BOSS</span></span>
<span class="line"></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>isMiniBoss<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token comment">// 小BOSS</span></span>
<span class="line">              enemies<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                  <span class="token literal-property property">x</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token constant">CANVAS_WIDTH</span> <span class="token operator">-</span> size <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token operator">-</span>size <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">width</span><span class="token operator">:</span> size <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">height</span><span class="token operator">:</span> size <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">speed</span><span class="token operator">:</span> <span class="token constant">ENEMY_SPEED</span> <span class="token operator">*</span> <span class="token number">0.7</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">health</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token operator">+</span> stage <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">maxHealth</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token operator">+</span> stage <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">isMiniBoss</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&#39;#FF4500&#39;</span></span>
<span class="line">              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token comment">// 普通敌人</span></span>
<span class="line">              enemies<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                  <span class="token literal-property property">x</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token constant">CANVAS_WIDTH</span> <span class="token operator">-</span> size<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token operator">-</span>size<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">width</span><span class="token operator">:</span> size<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">height</span><span class="token operator">:</span> size<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">speed</span><span class="token operator">:</span> <span class="token constant">ENEMY_SPEED</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0.8</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">health</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">maxHealth</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">isMiniBoss</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&#39;#6495ED&#39;</span></span>
<span class="line">              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 生成BOSS</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">spawnBoss</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">const</span> size <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></span>
<span class="line">          boss <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token constant">CANVAS_WIDTH</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">width</span><span class="token operator">:</span> size<span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">height</span><span class="token operator">:</span> size<span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">speed</span><span class="token operator">:</span> <span class="token constant">ENEMY_SPEED</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">health</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token operator">+</span> stage <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">maxHealth</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token operator">+</span> stage <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">isBoss</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&#39;#DC143C&#39;</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">skillTimer</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">phase</span><span class="token operator">:</span> <span class="token number">1</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">          bossActive <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;bossHealthContainer&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;block&#39;</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token function">updateBossHealth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 更新子弹</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">updateBullets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> bullets<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              bullets<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-=</span> bullets<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">              <span class="token comment">// 移除超出屏幕的子弹</span></span>
<span class="line">              <span class="token keyword">if</span> <span class="token punctuation">(</span>bullets<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">+</span> bullets<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>height <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  bullets<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 更新敌人</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">updateEnemies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> enemies<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              enemies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">+=</span> enemies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">              <span class="token comment">// 移除超出屏幕的敌人</span></span>
<span class="line">              <span class="token keyword">if</span> <span class="token punctuation">(</span>enemies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">&gt;</span> <span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  enemies<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 更新BOSS</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">updateBoss</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>boss<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// BOSS移动模式</span></span>
<span class="line">          boss<span class="token punctuation">.</span>x <span class="token operator">+=</span> boss<span class="token punctuation">.</span>speed<span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>boss<span class="token punctuation">.</span>x <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> boss<span class="token punctuation">.</span>x <span class="token operator">+</span> boss<span class="token punctuation">.</span>width <span class="token operator">&gt;=</span> <span class="token constant">CANVAS_WIDTH</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              boss<span class="token punctuation">.</span>speed <span class="token operator">*=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// BOSS技能</span></span>
<span class="line">          boss<span class="token punctuation">.</span>skillTimer <span class="token operator">+=</span> <span class="token number">16</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>boss<span class="token punctuation">.</span>skillTimer <span class="token operator">&gt;=</span> <span class="token constant">BOSS_SKILL_INTERVAL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token function">useBossSkill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              boss<span class="token punctuation">.</span>skillTimer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// BOSS阶段转换</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>boss<span class="token punctuation">.</span>health <span class="token operator">&lt;=</span> boss<span class="token punctuation">.</span>maxHealth <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> boss<span class="token punctuation">.</span>phase <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              boss<span class="token punctuation">.</span>phase <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">              boss<span class="token punctuation">.</span>speed <span class="token operator">*=</span> <span class="token number">1.5</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// BOSS使用技能</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">useBossSkill</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>boss<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>boss<span class="token punctuation">.</span>phase <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token comment">// 第一阶段技能：扇形子弹</span></span>
<span class="line">              <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  bossBullets<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                      <span class="token literal-property property">x</span><span class="token operator">:</span> boss<span class="token punctuation">.</span>x <span class="token operator">+</span> boss<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">,</span></span>
<span class="line">                      <span class="token literal-property property">y</span><span class="token operator">:</span> boss<span class="token punctuation">.</span>y <span class="token operator">+</span> boss<span class="token punctuation">.</span>height<span class="token punctuation">,</span></span>
<span class="line">                      <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span></span>
<span class="line">                      <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span></span>
<span class="line">                      <span class="token literal-property property">speedX</span><span class="token operator">:</span> i <span class="token operator">*</span> <span class="token number">1.5</span><span class="token punctuation">,</span></span>
<span class="line">                      <span class="token literal-property property">speedY</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span></span>
<span class="line">                      <span class="token literal-property property">power</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">                      <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&#39;#FF6347&#39;</span></span>
<span class="line">                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token comment">// 第二阶段技能：环形子弹 + 追踪子弹</span></span>
<span class="line">              <span class="token comment">// 环形子弹</span></span>
<span class="line">              <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  <span class="token keyword">const</span> angle <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">                  bossBullets<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                      <span class="token literal-property property">x</span><span class="token operator">:</span> boss<span class="token punctuation">.</span>x <span class="token operator">+</span> boss<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">,</span></span>
<span class="line">                      <span class="token literal-property property">y</span><span class="token operator">:</span> boss<span class="token punctuation">.</span>y <span class="token operator">+</span> boss<span class="token punctuation">.</span>height<span class="token punctuation">,</span></span>
<span class="line">                      <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span></span>
<span class="line">                      <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span></span>
<span class="line">                      <span class="token literal-property property">speedX</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">                      <span class="token literal-property property">speedY</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">                      <span class="token literal-property property">power</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">                      <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&#39;#FF6347&#39;</span></span>
<span class="line">                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">              <span class="token comment">// 追踪子弹</span></span>
<span class="line">              <span class="token keyword">const</span> angle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span></span>
<span class="line">                  player<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token punctuation">(</span>boss<span class="token punctuation">.</span>y <span class="token operator">+</span> boss<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                  player<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token punctuation">(</span>boss<span class="token punctuation">.</span>x <span class="token operator">+</span> boss<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">              <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              bossBullets<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                  <span class="token literal-property property">x</span><span class="token operator">:</span> boss<span class="token punctuation">.</span>x <span class="token operator">+</span> boss<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">7</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">y</span><span class="token operator">:</span> boss<span class="token punctuation">.</span>y <span class="token operator">+</span> boss<span class="token punctuation">.</span>height<span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">speedX</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">speedY</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">power</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&#39;#FF0000&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">isHoming</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 更新BOSS子弹</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">updateBossBullets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> bossBullets<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token keyword">const</span> bullet <span class="token operator">=</span> bossBullets<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">              <span class="token comment">// 更新位置</span></span>
<span class="line">              bullet<span class="token punctuation">.</span>x <span class="token operator">+=</span> bullet<span class="token punctuation">.</span>speedX<span class="token punctuation">;</span></span>
<span class="line">              bullet<span class="token punctuation">.</span>y <span class="token operator">+=</span> bullet<span class="token punctuation">.</span>speedY<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">              <span class="token comment">// 追踪子弹更新方向</span></span>
<span class="line">              <span class="token keyword">if</span> <span class="token punctuation">(</span>bullet<span class="token punctuation">.</span>isHoming<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  <span class="token keyword">const</span> angle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span></span>
<span class="line">                      player<span class="token punctuation">.</span>y <span class="token operator">-</span> bullet<span class="token punctuation">.</span>y<span class="token punctuation">,</span></span>
<span class="line">                      player<span class="token punctuation">.</span>x <span class="token operator">-</span> bullet<span class="token punctuation">.</span>x</span>
<span class="line">                  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                  bullet<span class="token punctuation">.</span>speedX <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span></span>
<span class="line">                  bullet<span class="token punctuation">.</span>speedY <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">              <span class="token comment">// 移除超出屏幕的子弹</span></span>
<span class="line">              <span class="token keyword">if</span> <span class="token punctuation">(</span>bullet<span class="token punctuation">.</span>y <span class="token operator">&gt;</span> <span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">||</span> bullet<span class="token punctuation">.</span>y <span class="token operator">+</span> bullet<span class="token punctuation">.</span>height <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span></span>
<span class="line">                  bullet<span class="token punctuation">.</span>x <span class="token operator">&gt;</span> <span class="token constant">CANVAS_WIDTH</span> <span class="token operator">||</span> bullet<span class="token punctuation">.</span>x <span class="token operator">+</span> bullet<span class="token punctuation">.</span>width <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  bossBullets<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 更新道具</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">updatePowerUps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> powerUps<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              powerUps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">              <span class="token comment">// 移除超出屏幕的道具</span></span>
<span class="line">              <span class="token keyword">if</span> <span class="token punctuation">(</span>powerUps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">&gt;</span> <span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  powerUps<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 更新爆炸效果</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">updateExplosions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> explosions<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              explosions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>timer<span class="token operator">--</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">              <span class="token comment">// 移除结束的爆炸效果</span></span>
<span class="line">              <span class="token keyword">if</span> <span class="token punctuation">(</span>explosions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>timer <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  explosions<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 检查碰撞</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">checkCollisions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token comment">// 子弹与敌人碰撞</span></span>
<span class="line">          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> bullets<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token keyword">const</span> bullet <span class="token operator">=</span> bullets<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">              <span class="token comment">// 检查与普通敌人的碰撞</span></span>
<span class="line">              <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> enemies<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  <span class="token keyword">const</span> enemy <span class="token operator">=</span> enemies<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkCollision</span><span class="token punctuation">(</span>bullet<span class="token punctuation">,</span> enemy<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                      <span class="token comment">// 敌人受伤</span></span>
<span class="line">                      enemy<span class="token punctuation">.</span>health <span class="token operator">-=</span> bullet<span class="token punctuation">.</span>power<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                      <span class="token comment">// 移除子弹</span></span>
<span class="line">                      bullets<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                      <span class="token comment">// 检查敌人是否被击败</span></span>
<span class="line">                      <span class="token keyword">if</span> <span class="token punctuation">(</span>enemy<span class="token punctuation">.</span>health <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                          <span class="token comment">// 增加分数和经验</span></span>
<span class="line">                          <span class="token keyword">const</span> expGain <span class="token operator">=</span> enemy<span class="token punctuation">.</span>isMiniBoss <span class="token operator">?</span> <span class="token number">20</span> <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line">                          <span class="token keyword">const</span> scoreGain <span class="token operator">=</span> enemy<span class="token punctuation">.</span>isMiniBoss <span class="token operator">?</span> <span class="token number">200</span> <span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                          player<span class="token punctuation">.</span>score <span class="token operator">+=</span> scoreGain<span class="token punctuation">;</span></span>
<span class="line">                          player<span class="token punctuation">.</span>exp <span class="token operator">+=</span> expGain<span class="token punctuation">;</span></span>
<span class="line">                          enemiesDefeatedThisStage<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">                          <span class="token comment">// 生成爆炸效果</span></span>
<span class="line">                          <span class="token function">createExplosion</span><span class="token punctuation">(</span>enemy<span class="token punctuation">.</span>x <span class="token operator">+</span> enemy<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> enemy<span class="token punctuation">.</span>y <span class="token operator">+</span> enemy<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> enemy<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                          <span class="token comment">// 随机生成道具</span></span>
<span class="line">                          <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span>enemy<span class="token punctuation">.</span>isMiniBoss <span class="token operator">?</span> <span class="token number">0.8</span> <span class="token operator">:</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                              <span class="token function">spawnPowerUp</span><span class="token punctuation">(</span>enemy<span class="token punctuation">.</span>x <span class="token operator">+</span> enemy<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> enemy<span class="token punctuation">.</span>y <span class="token operator">+</span> enemy<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> enemy<span class="token punctuation">.</span>isMiniBoss<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                          <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                          <span class="token comment">// 移除敌人</span></span>
<span class="line">                          enemies<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                      <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                  <span class="token punctuation">}</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">              <span class="token comment">// 检查与BOSS的碰撞</span></span>
<span class="line">              <span class="token keyword">if</span> <span class="token punctuation">(</span>boss <span class="token operator">&amp;&amp;</span> <span class="token function">checkCollision</span><span class="token punctuation">(</span>bullet<span class="token punctuation">,</span> boss<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  <span class="token comment">// BOSS受伤</span></span>
<span class="line">                  boss<span class="token punctuation">.</span>health <span class="token operator">-=</span> bullet<span class="token punctuation">.</span>power<span class="token punctuation">;</span></span>
<span class="line">                  <span class="token function">updateBossHealth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                  <span class="token comment">// 移除子弹</span></span>
<span class="line">                  bullets<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                  <span class="token comment">// 检查BOSS是否被击败</span></span>
<span class="line">                  <span class="token keyword">if</span> <span class="token punctuation">(</span>boss<span class="token punctuation">.</span>health <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                      <span class="token comment">// 增加分数和经验</span></span>
<span class="line">                      player<span class="token punctuation">.</span>score <span class="token operator">+=</span> <span class="token number">1000</span><span class="token punctuation">;</span></span>
<span class="line">                      player<span class="token punctuation">.</span>exp <span class="token operator">+=</span> <span class="token number">100</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                      <span class="token comment">// 生成爆炸效果</span></span>
<span class="line">                      <span class="token function">createExplosion</span><span class="token punctuation">(</span>boss<span class="token punctuation">.</span>x <span class="token operator">+</span> boss<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> boss<span class="token punctuation">.</span>y <span class="token operator">+</span> boss<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> boss<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                      <span class="token comment">// 移除BOSS</span></span>
<span class="line">                      boss <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">                      bossActive <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">                      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;bossHealthContainer&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                      <span class="token comment">// 检查是否是最终BOSS</span></span>
<span class="line">                      <span class="token keyword">if</span> <span class="token punctuation">(</span>stage <span class="token operator">&gt;=</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                          <span class="token function">victory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                          <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">                      <span class="token punctuation">}</span></span>
<span class="line">                  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                  <span class="token keyword">continue</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 玩家与敌人碰撞</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>player<span class="token punctuation">.</span>invulnerable<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> enemies<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  <span class="token keyword">const</span> enemy <span class="token operator">=</span> enemies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkCollision</span><span class="token punctuation">(</span>player<span class="token punctuation">,</span> enemy<span class="token punctuation">,</span> player<span class="token punctuation">.</span>sizeMultiplier<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                      <span class="token comment">// 玩家受伤</span></span>
<span class="line">                      player<span class="token punctuation">.</span>lives<span class="token operator">--</span><span class="token punctuation">;</span></span>
<span class="line">                      <span class="token function">updateHUD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                      <span class="token comment">// 生成爆炸效果</span></span>
<span class="line">                      <span class="token function">createExplosion</span><span class="token punctuation">(</span>enemy<span class="token punctuation">.</span>x <span class="token operator">+</span> enemy<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> enemy<span class="token punctuation">.</span>y <span class="token operator">+</span> enemy<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> enemy<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                      <span class="token comment">// 移除敌人</span></span>
<span class="line">                      enemies<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                      <span class="token comment">// 设置无敌时间</span></span>
<span class="line">                      player<span class="token punctuation">.</span>invulnerable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">                      player<span class="token punctuation">.</span>invulnerableEndTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2000</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                      <span class="token comment">// 检查游戏是否结束</span></span>
<span class="line">                      <span class="token keyword">if</span> <span class="token punctuation">(</span>player<span class="token punctuation">.</span>lives <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                          <span class="token function">gameOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                          <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">                      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                      <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                  <span class="token punctuation">}</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">              <span class="token comment">// 玩家与BOSS碰撞</span></span>
<span class="line">              <span class="token keyword">if</span> <span class="token punctuation">(</span>boss <span class="token operator">&amp;&amp;</span> <span class="token function">checkCollision</span><span class="token punctuation">(</span>player<span class="token punctuation">,</span> boss<span class="token punctuation">,</span> player<span class="token punctuation">.</span>sizeMultiplier<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  <span class="token comment">// 玩家受伤</span></span>
<span class="line">                  player<span class="token punctuation">.</span>lives<span class="token operator">--</span><span class="token punctuation">;</span></span>
<span class="line">                  <span class="token function">updateHUD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                  <span class="token comment">// 设置无敌时间</span></span>
<span class="line">                  player<span class="token punctuation">.</span>invulnerable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">                  player<span class="token punctuation">.</span>invulnerableEndTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2000</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                  <span class="token comment">// 检查游戏是否结束</span></span>
<span class="line">                  <span class="token keyword">if</span> <span class="token punctuation">(</span>player<span class="token punctuation">.</span>lives <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                      <span class="token function">gameOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                      <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">                  <span class="token punctuation">}</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">              <span class="token comment">// 玩家与BOSS子弹碰撞</span></span>
<span class="line">              <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> bossBullets<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  <span class="token keyword">const</span> bullet <span class="token operator">=</span> bossBullets<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkCollision</span><span class="token punctuation">(</span>player<span class="token punctuation">,</span> bullet<span class="token punctuation">,</span> player<span class="token punctuation">.</span>sizeMultiplier<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                      <span class="token comment">// 玩家受伤</span></span>
<span class="line">                      player<span class="token punctuation">.</span>lives<span class="token operator">--</span><span class="token punctuation">;</span></span>
<span class="line">                      <span class="token function">updateHUD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                      <span class="token comment">// 移除子弹</span></span>
<span class="line">                      bossBullets<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                      <span class="token comment">// 设置无敌时间</span></span>
<span class="line">                      player<span class="token punctuation">.</span>invulnerable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">                      player<span class="token punctuation">.</span>invulnerableEndTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2000</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                      <span class="token comment">// 检查游戏是否结束</span></span>
<span class="line">                      <span class="token keyword">if</span> <span class="token punctuation">(</span>player<span class="token punctuation">.</span>lives <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                          <span class="token function">gameOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                          <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">                      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                      <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                  <span class="token punctuation">}</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 玩家与道具碰撞</span></span>
<span class="line">          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> powerUps<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token keyword">const</span> powerUp <span class="token operator">=</span> powerUps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkCollision</span><span class="token punctuation">(</span>player<span class="token punctuation">,</span> powerUp<span class="token punctuation">,</span> player<span class="token punctuation">.</span>sizeMultiplier<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  <span class="token comment">// 应用道具效果</span></span>
<span class="line">                  <span class="token function">applyPowerUp</span><span class="token punctuation">(</span>powerUp<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                  <span class="token comment">// 移除道具</span></span>
<span class="line">                  powerUps<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 检查经验值是否足够升级</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>player<span class="token punctuation">.</span>exp <span class="token operator">&gt;=</span> player<span class="token punctuation">.</span>expNeeded<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token function">levelUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 检查碰撞</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">checkCollision</span><span class="token punctuation">(</span><span class="token parameter">obj1<span class="token punctuation">,</span> obj2<span class="token punctuation">,</span> sizeMultiplier <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">return</span> obj1<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> obj2<span class="token punctuation">.</span>x <span class="token operator">+</span> obj2<span class="token punctuation">.</span>width <span class="token operator">&amp;&amp;</span></span>
<span class="line">              obj1<span class="token punctuation">.</span>x <span class="token operator">+</span> obj1<span class="token punctuation">.</span>width <span class="token operator">*</span> sizeMultiplier <span class="token operator">&gt;</span> obj2<span class="token punctuation">.</span>x <span class="token operator">&amp;&amp;</span></span>
<span class="line">              obj1<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> obj2<span class="token punctuation">.</span>y <span class="token operator">+</span> obj2<span class="token punctuation">.</span>height <span class="token operator">&amp;&amp;</span></span>
<span class="line">              obj1<span class="token punctuation">.</span>y <span class="token operator">+</span> obj1<span class="token punctuation">.</span>height <span class="token operator">*</span> sizeMultiplier <span class="token operator">&gt;</span> obj2<span class="token punctuation">.</span>y<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 生成道具</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">spawnPowerUp</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> isMiniBoss</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">const</span> types <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;fireRate&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;bulletPower&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;multiShot&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sizeUp&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">let</span> type<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>isMiniBoss<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token comment">// 小BOSS掉落更好的道具</span></span>
<span class="line">              <span class="token keyword">const</span> bossTypes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;superFireRate&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;superBulletPower&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;tripleShot&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;giantSize&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">              type <span class="token operator">=</span> bossTypes<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> bossTypes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">              type <span class="token operator">=</span> types<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> types<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">          powerUps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">              <span class="token literal-property property">x</span><span class="token operator">:</span> x <span class="token operator">-</span> <span class="token number">15</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">y</span><span class="token operator">:</span> y <span class="token operator">-</span> <span class="token number">15</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">type</span><span class="token operator">:</span> type<span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token function">getPowerUpColor</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 获取道具颜色</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">getPowerUpColor</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token keyword">case</span> <span class="token string">&#39;fireRate&#39;</span><span class="token operator">:</span></span>
<span class="line">                  <span class="token keyword">return</span> <span class="token string">&#39;#FFD700&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 金色</span></span>
<span class="line">              <span class="token keyword">case</span> <span class="token string">&#39;superFireRate&#39;</span><span class="token operator">:</span></span>
<span class="line">                  <span class="token keyword">return</span> <span class="token string">&#39;#FFA500&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 橙色</span></span>
<span class="line">              <span class="token keyword">case</span> <span class="token string">&#39;bulletPower&#39;</span><span class="token operator">:</span></span>
<span class="line">                  <span class="token keyword">return</span> <span class="token string">&#39;#FF0000&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 红色</span></span>
<span class="line">              <span class="token keyword">case</span> <span class="token string">&#39;superBulletPower&#39;</span><span class="token operator">:</span></span>
<span class="line">                  <span class="token keyword">return</span> <span class="token string">&#39;#8B0000&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 深红色</span></span>
<span class="line">              <span class="token keyword">case</span> <span class="token string">&#39;multiShot&#39;</span><span class="token operator">:</span></span>
<span class="line">                  <span class="token keyword">return</span> <span class="token string">&#39;#00FF00&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 绿色</span></span>
<span class="line">              <span class="token keyword">case</span> <span class="token string">&#39;tripleShot&#39;</span><span class="token operator">:</span></span>
<span class="line">                  <span class="token keyword">return</span> <span class="token string">&#39;#008000&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 深绿色</span></span>
<span class="line">              <span class="token keyword">case</span> <span class="token string">&#39;sizeUp&#39;</span><span class="token operator">:</span></span>
<span class="line">                  <span class="token keyword">return</span> <span class="token string">&#39;#ADD8E6&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 浅蓝色</span></span>
<span class="line">              <span class="token keyword">case</span> <span class="token string">&#39;giantSize&#39;</span><span class="token operator">:</span></span>
<span class="line">                  <span class="token keyword">return</span> <span class="token string">&#39;#0000FF&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 蓝色</span></span>
<span class="line">              <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">                  <span class="token keyword">return</span> <span class="token string">&#39;#FFFFFF&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 白色</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 应用道具效果</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">applyPowerUp</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          player<span class="token punctuation">.</span>isPoweredUp <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">          player<span class="token punctuation">.</span>powerUpType <span class="token operator">=</span> type<span class="token punctuation">;</span></span>
<span class="line">          player<span class="token punctuation">.</span>powerUpEndTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">POWERUP_DURATION</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token keyword">case</span> <span class="token string">&#39;fireRate&#39;</span><span class="token operator">:</span></span>
<span class="line">                  player<span class="token punctuation">.</span>fireRate <span class="token operator">=</span> <span class="token number">150</span><span class="token punctuation">;</span> <span class="token comment">// 射击速度提高</span></span>
<span class="line">                  <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token keyword">case</span> <span class="token string">&#39;superFireRate&#39;</span><span class="token operator">:</span></span>
<span class="line">                  player<span class="token punctuation">.</span>fireRate <span class="token operator">=</span> <span class="token number">75</span><span class="token punctuation">;</span> <span class="token comment">// 超级射击速度</span></span>
<span class="line">                  <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token keyword">case</span> <span class="token string">&#39;bulletPower&#39;</span><span class="token operator">:</span></span>
<span class="line">                  player<span class="token punctuation">.</span>bulletPower <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 子弹威力提高</span></span>
<span class="line">                  <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token keyword">case</span> <span class="token string">&#39;superBulletPower&#39;</span><span class="token operator">:</span></span>
<span class="line">                  player<span class="token punctuation">.</span>bulletPower <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// 超级子弹威力</span></span>
<span class="line">                  <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token keyword">case</span> <span class="token string">&#39;multiShot&#39;</span><span class="token operator">:</span></span>
<span class="line">                  player<span class="token punctuation">.</span>multiShot <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 双发子弹</span></span>
<span class="line">                  <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token keyword">case</span> <span class="token string">&#39;tripleShot&#39;</span><span class="token operator">:</span></span>
<span class="line">                  player<span class="token punctuation">.</span>multiShot <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 三发子弹</span></span>
<span class="line">                  <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token keyword">case</span> <span class="token string">&#39;sizeUp&#39;</span><span class="token operator">:</span></span>
<span class="line">                  player<span class="token punctuation">.</span>sizeMultiplier <span class="token operator">=</span> <span class="token number">1.5</span><span class="token punctuation">;</span> <span class="token comment">// 变大</span></span>
<span class="line">                  <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token keyword">case</span> <span class="token string">&#39;giantSize&#39;</span><span class="token operator">:</span></span>
<span class="line">                  player<span class="token punctuation">.</span>sizeMultiplier <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 巨大化</span></span>
<span class="line">                  <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 创建爆炸效果</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">createExplosion</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> size</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          explosions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">              <span class="token literal-property property">x</span><span class="token operator">:</span> x<span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">y</span><span class="token operator">:</span> y<span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">size</span><span class="token operator">:</span> size<span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">timer</span><span class="token operator">:</span> <span class="token number">20</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 检查关卡进度</span></span>
<span class="line">      <span class="token comment">// 修正后的 checkStageProgress 函数</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">checkStageProgress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token comment">// 每关需要击败的敌人数量</span></span>
<span class="line">          <span class="token keyword">const</span> enemiesPerStage <span class="token operator">=</span> <span class="token number">20</span> <span class="token operator">+</span> stage <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 计算当前关卡已击败的敌人数量</span></span>
<span class="line">          <span class="token comment">// 这里需要跟踪总击败数，而不是用 enemies.length 来计算</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>enemiesDefeatedThisStage <span class="token operator">&gt;=</span> enemiesPerStage <span class="token operator">&amp;&amp;</span> enemies<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>bossActive<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              stage<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">              enemiesDefeatedThisStage <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 重置当前关卡击败数</span></span>
<span class="line">              <span class="token function">updateHUD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">              <span class="token comment">// 只在第5关(或5的倍数关)出现最终BOSS</span></span>
<span class="line">              <span class="token keyword">if</span> <span class="token punctuation">(</span>stage <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  <span class="token function">spawnBoss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 升级</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">levelUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          player<span class="token punctuation">.</span>level<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">          player<span class="token punctuation">.</span>exp <span class="token operator">-=</span> player<span class="token punctuation">.</span>expNeeded<span class="token punctuation">;</span></span>
<span class="line">          player<span class="token punctuation">.</span>expNeeded <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>player<span class="token punctuation">.</span>expNeeded <span class="token operator">*</span> <span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token function">updateHUD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 暂停游戏让玩家选择升级</span></span>
<span class="line">          gameRunning <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;levelUpScreen&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;flex&#39;</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 应用等级提升</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">applyLevelUp</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token keyword">case</span> <span class="token string">&#39;fireRate&#39;</span><span class="token operator">:</span></span>
<span class="line">                  player<span class="token punctuation">.</span>fireRate <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> player<span class="token punctuation">.</span>fireRate <span class="token operator">-</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                  <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token keyword">case</span> <span class="token string">&#39;bulletPower&#39;</span><span class="token operator">:</span></span>
<span class="line">                  player<span class="token punctuation">.</span>bulletPower<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">                  <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token keyword">case</span> <span class="token string">&#39;multiShot&#39;</span><span class="token operator">:</span></span>
<span class="line">                  player<span class="token punctuation">.</span>multiShot <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> player<span class="token punctuation">.</span>multiShot <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                  <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 更新HUD</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">updateHUD</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;lives&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> player<span class="token punctuation">.</span>lives<span class="token punctuation">;</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;score&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> player<span class="token punctuation">.</span>score<span class="token punctuation">;</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;level&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> player<span class="token punctuation">.</span>level<span class="token punctuation">;</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;exp&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> player<span class="token punctuation">.</span>exp<span class="token punctuation">;</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;expNeeded&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> player<span class="token punctuation">.</span>expNeeded<span class="token punctuation">;</span></span>
<span class="line">          document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;stage&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> stage<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 更新BOSS生命值显示</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">updateBossHealth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>boss<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;bossHealth&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> boss<span class="token punctuation">.</span>health<span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 绘制游戏</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token comment">// 绘制背景</span></span>
<span class="line">          <span class="token function">drawBackground</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 绘制子弹</span></span>
<span class="line">          <span class="token function">drawBullets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 绘制BOSS子弹</span></span>
<span class="line">          <span class="token function">drawBossBullets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 绘制敌人</span></span>
<span class="line">          <span class="token function">drawEnemies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 绘制BOSS</span></span>
<span class="line">          <span class="token function">drawBoss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 绘制道具</span></span>
<span class="line">          <span class="token function">drawPowerUps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 绘制爆炸效果</span></span>
<span class="line">          <span class="token function">drawExplosions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 绘制玩家</span></span>
<span class="line">          <span class="token function">drawPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 绘制HUD</span></span>
<span class="line">          <span class="token function">drawHUD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 绘制背景</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">drawBackground</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token comment">// 渐变背景</span></span>
<span class="line">          <span class="token keyword">const</span> gradient <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">createLinearGradient</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;#000033&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;#000011&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> gradient<span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_WIDTH</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 星星</span></span>
<span class="line">          ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&#39;white&#39;</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token keyword">const</span> x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">CANVAS_WIDTH</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">+</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token keyword">const</span> size <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">              ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> size<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 绘制子弹</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">drawBullets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&#39;#FFFF00&#39;</span><span class="token punctuation">;</span></span>
<span class="line">          bullets<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">bullet</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">              ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>bullet<span class="token punctuation">.</span>x<span class="token punctuation">,</span> bullet<span class="token punctuation">.</span>y<span class="token punctuation">,</span> bullet<span class="token punctuation">.</span>width<span class="token punctuation">,</span> bullet<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 绘制BOSS子弹</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">drawBossBullets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          bossBullets<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">bullet</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">              ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> bullet<span class="token punctuation">.</span>color<span class="token punctuation">;</span></span>
<span class="line">              ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>bullet<span class="token punctuation">.</span>x <span class="token operator">+</span> bullet<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> bullet<span class="token punctuation">.</span>y <span class="token operator">+</span> bullet<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> bullet<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 绘制敌人</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">drawEnemies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          enemies<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">enemy</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token comment">// 绘制敌人</span></span>
<span class="line">              ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> enemy<span class="token punctuation">.</span>color<span class="token punctuation">;</span></span>
<span class="line">              ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>enemy<span class="token punctuation">.</span>x <span class="token operator">+</span> enemy<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> enemy<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>enemy<span class="token punctuation">.</span>x <span class="token operator">+</span> enemy<span class="token punctuation">.</span>width<span class="token punctuation">,</span> enemy<span class="token punctuation">.</span>y <span class="token operator">+</span> enemy<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>enemy<span class="token punctuation">.</span>x<span class="token punctuation">,</span> enemy<span class="token punctuation">.</span>y <span class="token operator">+</span> enemy<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              ctx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">              <span class="token comment">// 如果是小BOSS，绘制生命条</span></span>
<span class="line">              <span class="token keyword">if</span> <span class="token punctuation">(</span>enemy<span class="token punctuation">.</span>isMiniBoss<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  <span class="token keyword">const</span> healthBarWidth <span class="token operator">=</span> enemy<span class="token punctuation">.</span>width<span class="token punctuation">;</span></span>
<span class="line">                  <span class="token keyword">const</span> healthBarHeight <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></span>
<span class="line">                  <span class="token keyword">const</span> healthPercentage <span class="token operator">=</span> enemy<span class="token punctuation">.</span>health <span class="token operator">/</span> enemy<span class="token punctuation">.</span>maxHealth<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                  ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&#39;red&#39;</span><span class="token punctuation">;</span></span>
<span class="line">                  ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>enemy<span class="token punctuation">.</span>x<span class="token punctuation">,</span> enemy<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">,</span> healthBarWidth<span class="token punctuation">,</span> healthBarHeight<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                  ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&#39;green&#39;</span><span class="token punctuation">;</span></span>
<span class="line">                  ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>enemy<span class="token punctuation">.</span>x<span class="token punctuation">,</span> enemy<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">,</span> healthBarWidth <span class="token operator">*</span> healthPercentage<span class="token punctuation">,</span> healthBarHeight<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 绘制BOSS</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">drawBoss</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>boss<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 绘制BOSS</span></span>
<span class="line">          ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> boss<span class="token punctuation">.</span>color<span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>boss<span class="token punctuation">.</span>x <span class="token operator">+</span> boss<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> boss<span class="token punctuation">.</span>y <span class="token operator">+</span> boss<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> boss<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 绘制BOSS眼睛</span></span>
<span class="line">          ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&#39;white&#39;</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>boss<span class="token punctuation">.</span>x <span class="token operator">+</span> boss<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">,</span> boss<span class="token punctuation">.</span>y <span class="token operator">+</span> boss<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">,</span> boss<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>boss<span class="token punctuation">.</span>x <span class="token operator">+</span> boss<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">,</span> boss<span class="token punctuation">.</span>y <span class="token operator">+</span> boss<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">,</span> boss<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&#39;black&#39;</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>boss<span class="token punctuation">.</span>x <span class="token operator">+</span> boss<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">,</span> boss<span class="token punctuation">.</span>y <span class="token operator">+</span> boss<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">,</span> boss<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>boss<span class="token punctuation">.</span>x <span class="token operator">+</span> boss<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">,</span> boss<span class="token punctuation">.</span>y <span class="token operator">+</span> boss<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">,</span> boss<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 绘制BOSS嘴巴</span></span>
<span class="line">          ctx<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">&#39;black&#39;</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>boss<span class="token punctuation">.</span>x <span class="token operator">+</span> boss<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> boss<span class="token punctuation">.</span>y <span class="token operator">+</span> boss<span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">,</span> boss<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 绘制BOSS生命条</span></span>
<span class="line">          <span class="token keyword">const</span> healthBarWidth <span class="token operator">=</span> boss<span class="token punctuation">.</span>width<span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">const</span> healthBarHeight <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">const</span> healthPercentage <span class="token operator">=</span> boss<span class="token punctuation">.</span>health <span class="token operator">/</span> boss<span class="token punctuation">.</span>maxHealth<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&#39;red&#39;</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>boss<span class="token punctuation">.</span>x<span class="token punctuation">,</span> boss<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token number">20</span><span class="token punctuation">,</span> healthBarWidth<span class="token punctuation">,</span> healthBarHeight<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&#39;green&#39;</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>boss<span class="token punctuation">.</span>x<span class="token punctuation">,</span> boss<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token number">20</span><span class="token punctuation">,</span> healthBarWidth <span class="token operator">*</span> healthPercentage<span class="token punctuation">,</span> healthBarHeight<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 绘制道具</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">drawPowerUps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          powerUps<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">powerUp</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">              ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> powerUp<span class="token punctuation">.</span>color<span class="token punctuation">;</span></span>
<span class="line">              ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>powerUp<span class="token punctuation">.</span>x <span class="token operator">+</span> powerUp<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> powerUp<span class="token punctuation">.</span>y <span class="token operator">+</span> powerUp<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> powerUp<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">              <span class="token comment">// 绘制道具图标</span></span>
<span class="line">              ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&#39;white&#39;</span><span class="token punctuation">;</span></span>
<span class="line">              ctx<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">&#39;16px Arial&#39;</span><span class="token punctuation">;</span></span>
<span class="line">              ctx<span class="token punctuation">.</span>textAlign <span class="token operator">=</span> <span class="token string">&#39;center&#39;</span><span class="token punctuation">;</span></span>
<span class="line">              ctx<span class="token punctuation">.</span>textBaseline <span class="token operator">=</span> <span class="token string">&#39;middle&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">              <span class="token keyword">let</span> symbol <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token keyword">switch</span> <span class="token punctuation">(</span>powerUp<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  <span class="token keyword">case</span> <span class="token string">&#39;fireRate&#39;</span><span class="token operator">:</span></span>
<span class="line">                  <span class="token keyword">case</span> <span class="token string">&#39;superFireRate&#39;</span><span class="token operator">:</span></span>
<span class="line">                      symbol <span class="token operator">=</span> <span class="token string">&#39;⚡&#39;</span><span class="token punctuation">;</span></span>
<span class="line">                      <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                  <span class="token keyword">case</span> <span class="token string">&#39;bulletPower&#39;</span><span class="token operator">:</span></span>
<span class="line">                  <span class="token keyword">case</span> <span class="token string">&#39;superBulletPower&#39;</span><span class="token operator">:</span></span>
<span class="line">                      symbol <span class="token operator">=</span> <span class="token string">&#39;💥&#39;</span><span class="token punctuation">;</span></span>
<span class="line">                      <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                  <span class="token keyword">case</span> <span class="token string">&#39;multiShot&#39;</span><span class="token operator">:</span></span>
<span class="line">                  <span class="token keyword">case</span> <span class="token string">&#39;tripleShot&#39;</span><span class="token operator">:</span></span>
<span class="line">                      symbol <span class="token operator">=</span> <span class="token string">&#39;🔫&#39;</span><span class="token punctuation">;</span></span>
<span class="line">                      <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                  <span class="token keyword">case</span> <span class="token string">&#39;sizeUp&#39;</span><span class="token operator">:</span></span>
<span class="line">                  <span class="token keyword">case</span> <span class="token string">&#39;giantSize&#39;</span><span class="token operator">:</span></span>
<span class="line">                      symbol <span class="token operator">=</span> <span class="token string">&#39;🔶&#39;</span><span class="token punctuation">;</span></span>
<span class="line">                      <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">              ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>symbol<span class="token punctuation">,</span> powerUp<span class="token punctuation">.</span>x <span class="token operator">+</span> powerUp<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> powerUp<span class="token punctuation">.</span>y <span class="token operator">+</span> powerUp<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 绘制爆炸效果</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">drawExplosions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          explosions<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">explosion</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token keyword">const</span> radius <span class="token operator">=</span> explosion<span class="token punctuation">.</span>size <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> explosion<span class="token punctuation">.</span>timer <span class="token operator">/</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token keyword">const</span> gradient <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">createRadialGradient</span><span class="token punctuation">(</span></span>
<span class="line">                  explosion<span class="token punctuation">.</span>x<span class="token punctuation">,</span> explosion<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">                  explosion<span class="token punctuation">.</span>x<span class="token punctuation">,</span> explosion<span class="token punctuation">.</span>y<span class="token punctuation">,</span> radius</span>
<span class="line">              <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;yellow&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token string">&#39;orange&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;red&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">              ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> gradient<span class="token punctuation">;</span></span>
<span class="line">              ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>explosion<span class="token punctuation">.</span>x<span class="token punctuation">,</span> explosion<span class="token punctuation">.</span>y<span class="token punctuation">,</span> radius<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 绘制玩家</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">drawPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">const</span> sizeMultiplier <span class="token operator">=</span> player<span class="token punctuation">.</span>sizeMultiplier<span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">const</span> width <span class="token operator">=</span> player<span class="token punctuation">.</span>width <span class="token operator">*</span> sizeMultiplier<span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">const</span> height <span class="token operator">=</span> player<span class="token punctuation">.</span>height <span class="token operator">*</span> sizeMultiplier<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 绘制玩家飞机</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>player<span class="token punctuation">.</span>invulnerable<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token comment">// 无敌状态闪烁效果</span></span>
<span class="line">              <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&#39;rgba(255, 255, 255, 0.5)&#39;</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                  ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&#39;rgba(0, 255, 255, 0.5)&#39;</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">              ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> player<span class="token punctuation">.</span>isPoweredUp <span class="token operator">?</span> <span class="token string">&#39;#00FFFF&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;#00FF00&#39;</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>player<span class="token punctuation">.</span>x <span class="token operator">+</span> width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> player<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>player<span class="token punctuation">.</span>x <span class="token operator">+</span> width<span class="token punctuation">,</span> player<span class="token punctuation">.</span>y <span class="token operator">+</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>player<span class="token punctuation">.</span>x <span class="token operator">+</span> width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> player<span class="token punctuation">.</span>y <span class="token operator">+</span> height <span class="token operator">*</span> <span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>player<span class="token punctuation">.</span>x<span class="token punctuation">,</span> player<span class="token punctuation">.</span>y <span class="token operator">+</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 绘制引擎火焰</span></span>
<span class="line">          ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&#39;orange&#39;</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>player<span class="token punctuation">.</span>x <span class="token operator">+</span> width <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> width <span class="token operator">*</span> <span class="token number">0.1</span><span class="token punctuation">,</span> player<span class="token punctuation">.</span>y <span class="token operator">+</span> height <span class="token operator">*</span> <span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>player<span class="token punctuation">.</span>x <span class="token operator">+</span> width <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> width <span class="token operator">*</span> <span class="token number">0.1</span><span class="token punctuation">,</span> player<span class="token punctuation">.</span>y <span class="token operator">+</span> height <span class="token operator">*</span> <span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>player<span class="token punctuation">.</span>x <span class="token operator">+</span> width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> player<span class="token punctuation">.</span>y <span class="token operator">+</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 绘制HUD</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">drawHUD</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token comment">// 绘制道具剩余时间</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>player<span class="token punctuation">.</span>isPoweredUp<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token keyword">const</span> remainingTime <span class="token operator">=</span> <span class="token punctuation">(</span>player<span class="token punctuation">.</span>powerUpEndTime <span class="token operator">-</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token keyword">if</span> <span class="token punctuation">(</span>remainingTime <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                  ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&#39;white&#39;</span><span class="token punctuation">;</span></span>
<span class="line">                  ctx<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">&#39;14px Arial&#39;</span><span class="token punctuation">;</span></span>
<span class="line">                  ctx<span class="token punctuation">.</span>textAlign <span class="token operator">=</span> <span class="token string">&#39;left&#39;</span><span class="token punctuation">;</span></span>
<span class="line">                  ctx<span class="token punctuation">.</span>textBaseline <span class="token operator">=</span> <span class="token string">&#39;top&#39;</span><span class="token punctuation">;</span></span>
<span class="line">                  ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>道具剩余<span class="token operator">:</span> $<span class="token punctuation">{</span>remainingTime<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span>s<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">-</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                  <span class="token comment">// 绘制道具图标</span></span>
<span class="line">                  ctx<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">&#39;20px Arial&#39;</span><span class="token punctuation">;</span></span>
<span class="line">                  <span class="token keyword">let</span> symbol <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span></span>
<span class="line">                  <span class="token keyword">switch</span> <span class="token punctuation">(</span>player<span class="token punctuation">.</span>powerUpType<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                      <span class="token keyword">case</span> <span class="token string">&#39;fireRate&#39;</span><span class="token operator">:</span></span>
<span class="line">                      <span class="token keyword">case</span> <span class="token string">&#39;superFireRate&#39;</span><span class="token operator">:</span></span>
<span class="line">                          symbol <span class="token operator">=</span> <span class="token string">&#39;⚡&#39;</span><span class="token punctuation">;</span></span>
<span class="line">                          <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                      <span class="token keyword">case</span> <span class="token string">&#39;bulletPower&#39;</span><span class="token operator">:</span></span>
<span class="line">                      <span class="token keyword">case</span> <span class="token string">&#39;superBulletPower&#39;</span><span class="token operator">:</span></span>
<span class="line">                          symbol <span class="token operator">=</span> <span class="token string">&#39;💥&#39;</span><span class="token punctuation">;</span></span>
<span class="line">                          <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                      <span class="token keyword">case</span> <span class="token string">&#39;multiShot&#39;</span><span class="token operator">:</span></span>
<span class="line">                      <span class="token keyword">case</span> <span class="token string">&#39;tripleShot&#39;</span><span class="token operator">:</span></span>
<span class="line">                          symbol <span class="token operator">=</span> <span class="token string">&#39;🔫&#39;</span><span class="token punctuation">;</span></span>
<span class="line">                          <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                      <span class="token keyword">case</span> <span class="token string">&#39;sizeUp&#39;</span><span class="token operator">:</span></span>
<span class="line">                      <span class="token keyword">case</span> <span class="token string">&#39;giantSize&#39;</span><span class="token operator">:</span></span>
<span class="line">                          symbol <span class="token operator">=</span> <span class="token string">&#39;🔶&#39;</span><span class="token punctuation">;</span></span>
<span class="line">                          <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                  <span class="token punctuation">}</span></span>
<span class="line">                  ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>symbol<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">-</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 绘制开始屏幕</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">drawStartScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&#39;rgba(0, 0, 0, 0.7)&#39;</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_WIDTH</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&#39;white&#39;</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">&#39;30px Arial&#39;</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span>textAlign <span class="token operator">=</span> <span class="token string">&#39;center&#39;</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span>textBaseline <span class="token operator">=</span> <span class="token string">&#39;middle&#39;</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">&#39;飞机大战&#39;</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_WIDTH</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          ctx<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">&#39;16px Arial&#39;</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">&#39;使用方向键移动，空格键射击&#39;</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_WIDTH</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">&#39;击败敌人获得经验升级&#39;</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_WIDTH</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">&#39;收集道具增强能力&#39;</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_WIDTH</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">&#39;最终击败BOSS赢得胜利!&#39;</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_WIDTH</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token constant">CANVAS_HEIGHT</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 键盘事件处理</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">handleKeyDown</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          keys<span class="token punctuation">[</span>e<span class="token punctuation">.</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">handleKeyUp</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          keys<span class="token punctuation">[</span>e<span class="token punctuation">.</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 初始化游戏</span></span>
<span class="line">      window<span class="token punctuation">.</span>onload <span class="token operator">=</span> init<span class="token punctuation">;</span></span>
<span class="line">    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3)])])}const i=s(e,[["render",l]]),u=JSON.parse('{"path":"/tool/cursor/%E6%9C%89%E8%B6%A3%E7%9A%84%E5%AE%9E%E7%8E%B0/cursor%20%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%A3%9E%E6%9C%BA%E5%A4%A7%E6%88%98.html","title":"cursor 实现一个飞机大战","lang":"zh-CN","frontmatter":{},"git":{"updatedTime":1768183010000,"contributors":[{"name":"qdleader","username":"qdleader","email":"yk4545945@163.com","commits":1,"url":"https://github.com/qdleader"}],"changelog":[{"hash":"c3ab6d103d428cdd6a361e045add7154fc9253f1","time":1768183010000,"email":"yk4545945@163.com","author":"qdleader","message":"docs(mcp): 新增Mastergo MCP配置文档，包含token获取方法"}]},"filePathRelative":"tool/cursor/有趣的实现/cursor 实现一个飞机大战.md"}');export{i as comp,u as data};
