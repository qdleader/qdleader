import{_ as s,c as a,a as p,o as t}from"./app-D8HvJIFE.js";const e={};function o(c,n){return t(),a("div",null,[...n[0]||(n[0]=[p(`<h1 id="在-uniapp-中嵌入-h5-后通信" tabindex="-1"><a class="header-anchor" href="#在-uniapp-中嵌入-h5-后通信"><span>在 uniapp 中嵌入 h5 后通信</span></a></h1><p>.因为 h5 需要向 app 发送事件，所以需要引入对应的 webview.js 文件。这是基础。uniapp 官方文档下载 uni.webview.1.5.4.js 到本地，在 h5 项目的 main.js 中全局引入</p><h2 id="vue2-版本-h5" tabindex="-1"><a class="header-anchor" href="#vue2-版本-h5"><span>vue2 版本 h5</span></a></h2><p>h5 的 main.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token string">&quot;@/mixin/uni.webview.1.5.4.js&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>2.在 h5 页面 methods 调用 uni.webView.postMessage 向 app 传参，mounted 里通过使用监听 app 中使用的 evalJs（）方法接收 app 传过来的参数，</p><p>h5 的 index.vue</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">//document.addEventListener() 方法用于向文档添加事件句柄，即事件监听。当相应的事件发生了，就执行对应的函数。</span></span>
<span class="line">            document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;getAppMsg&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">//webview接收uniapp传过来的信息</span></span>
<span class="line">                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;getAppMsg&#39;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>code<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"> <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">testScan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">               <span class="token comment">//h5向app传参，触发事件</span></span>
<span class="line">                uni<span class="token punctuation">.</span>webView<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">&#39;scanCode&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="vue3-版本-h5" tabindex="-1"><a class="header-anchor" href="#vue3-版本-h5"><span>vue3 版本 h5</span></a></h2><p>main.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> uni <span class="token keyword">from</span> <span class="token string">&quot;./utils/uni/uni.webview.1.5.6.js&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;UniAppJSBridgeReady&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;UniAppJSBridgeReady&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> uni<span class="token punctuation">,</span> uni<span class="token punctuation">.</span>webView<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  uni<span class="token punctuation">.</span>webView<span class="token operator">?.</span><span class="token function">getEnv</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;当前环境：&quot;</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">// uni.webView.navigateTo(...)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>index.vue</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token function-variable function">shareToWechat</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  uni<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">&quot;share&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;分享标题&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">&quot;分享描述&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;分享路径&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">fileName</span><span class="token operator">:</span> <span class="token string">&quot;分享文件名&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.app 的内嵌 webview 页面中，在 的 message 事件回调 event.detail.data 中接收 H5 发送给 App 的信息；通过拿到 webview 的内部对象，去调用系统的 evalJS 方法，传入字符串，将该方法内部的字符串在 webview 的 H5 中当做 js 代码去执行。</p><p>app 的 scanCode.vue</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//template</span></span>
<span class="line"><span class="token operator">&lt;</span>web<span class="token operator">-</span>view <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">&quot;src&quot;</span> @message<span class="token operator">=</span><span class="token string">&quot;message&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>web<span class="token operator">-</span>view<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//script</span></span>
<span class="line"><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">let</span> height <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//定义动态的高度变量</span></span>
<span class="line">            <span class="token keyword">let</span> statusbar <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 动态状态栏高度</span></span>
<span class="line">            uni<span class="token punctuation">.</span><span class="token function">getSystemInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 获取当前设备的具体信息</span></span>
<span class="line">                <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">sysinfo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                    statusbar <span class="token operator">=</span> sysinfo<span class="token punctuation">.</span>statusBarHeight <span class="token operator">+</span> <span class="token number">55</span><span class="token punctuation">;</span></span>
<span class="line">                    height <span class="token operator">=</span> sysinfo<span class="token punctuation">.</span>windowHeight <span class="token operator">-</span> <span class="token number">65</span><span class="token punctuation">;</span></span>
<span class="line">                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;高度&quot;</span><span class="token punctuation">,</span> statusbar<span class="token punctuation">,</span> height<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// #ifdef APP-PLUS</span></span>
<span class="line">            <span class="token keyword">let</span> currentWebview <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$mp<span class="token punctuation">.</span>page<span class="token punctuation">.</span><span class="token function">$getAppWebview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取当前web-view</span></span>
<span class="line">            <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span></span>
<span class="line">            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                that<span class="token punctuation">.</span>wv <span class="token operator">=</span> currentWebview<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">                that<span class="token punctuation">.</span>wv<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">//设置web-view距离顶部的距离以及自己的高度，单位为px</span></span>
<span class="line">                    <span class="token literal-property property">top</span><span class="token operator">:</span> statusbar<span class="token punctuation">,</span> <span class="token comment">//此处是距离顶部的高度，应该是你页面的头部</span></span>
<span class="line">                    <span class="token literal-property property">height</span><span class="token operator">:</span> height<span class="token punctuation">,</span> <span class="token comment">//webview的高度</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//如页面初始化调用需要写延迟</span></span>
<span class="line">            <span class="token comment">// #endif</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line"><span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">message</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//接收 H5 发送给 app 的消息</span></span>
<span class="line">        <span class="token comment">// e.detail.data 即为 H5 中 uni.webView.postMessage()的 data 的内容</span></span>
<span class="line">        <span class="token keyword">let</span> mesg <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;mesg&quot;</span><span class="token punctuation">,</span> mesg<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>mesg<span class="token punctuation">.</span>action <span class="token operator">==</span> <span class="token string">&quot;scanCode&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 允许从相机和相册扫码</span></span>
<span class="line">            uni<span class="token punctuation">.</span><span class="token function">scanCode</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">onlyFromCamera</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//只允许通过相机扫码</span></span>
<span class="line">                <span class="token literal-property property">scanType</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;qrCode&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//调起条码扫描</span></span>
<span class="line">                <span class="token literal-property property">autoDecodeCharset</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">res=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>res<span class="token punctuation">.</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> <span class="token comment">//res.result 为扫码结果</span></span>
<span class="line">                    <span class="token keyword">this</span><span class="token punctuation">.</span>wv<span class="token punctuation">.</span><span class="token function">evalJS</span><span class="token punctuation">(</span></span>
<span class="line">                    <span class="token string">&quot;document.dispatchEvent(new CustomEvent(&#39;getAppMsg&#39;,{detail: {code:&quot;</span> <span class="token operator">+</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>result<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;}}))&quot;</span></span>
<span class="line">                    <span class="token punctuation">)</span></span>
<span class="line">                <span class="token comment">//通过 evalJS()，传入方法字符串，将该方法内部的字符串在 webview 的 H5 中当做 js 代码去执行。</span></span>
<span class="line">                <span class="token comment">//document.dispatchEvent（）为创建自定义事件在 h5 中执行</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span>）</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>至此，完成了 app 与 h5 之间的动态传参通信</p>`,17)])])}const i=s(e,[["render",o]]),u=JSON.parse('{"path":"/uniapp/uniapp%E7%9A%84app%E4%B8%AD%E5%B5%8C%E5%85%A5h5%E4%B9%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1.html","title":"在 uniapp 中嵌入 h5 后通信","lang":"zh-CN","frontmatter":{},"git":{"updatedTime":1761877037000,"contributors":[{"name":"qdleader","username":"qdleader","email":"yk4545945@163.com","commits":1,"url":"https://github.com/qdleader"}],"changelog":[{"hash":"bd7640b59685e94edda53b9f6d34fbec27933dd4","time":1761877037000,"email":"yk4545945@163.com","author":"qdleader","message":"docs: 更新仓库链接和添加交流社区信息"}]},"filePathRelative":"uniapp/uniapp的app中嵌入h5之间的通信.md"}');export{i as comp,u as data};
